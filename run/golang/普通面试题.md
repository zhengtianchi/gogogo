# 普通面试题



## 1. 什么是协程（Goroutine）

协程是**用户态轻量级线程**，它是**线程调度的基本单位**。通常在函数前加上go关键字就能实现并发。一个Goroutine会以一个很小的栈启动2KB或4KB，当遇到栈空间不足时，栈会**自动伸缩**， 因此可以轻易实现成千上万个goroutine同时启动。



## 2. 2 个 interface 可以比较吗 ？



## 3. goroutine 里面 panic 了会怎么样

在Go语言中，我们通常会用到panic和recover来抛出错误和捕获错误，这一对操作在单协程环境下我们正常用就好了，并不会踩到什么坑。但是在多协程并发环境下，我们常常会碰到以下两个问题。假设我们现在有2个协程，我们叫它们协程A和B好了：

- 如果协程A发生了panic，协程B是否会因为协程A的panic而挂掉？
- 如果协程A发生了panic，协程B是否能用recover捕获到协程A的panic？

答案分别是：会、不能。

==总结==  在一个 gorouting 里 panic ，就要在其 gorouting recover ， 否则整个进程都崩了



## 4. go里面goroutine创建数量有限制吗？





## 5. 值类型和引用类型的区别？

1. 值类型在内存中存储的是值本身，而引用类型在内存中存储的是值的内存地址。
2. 值类型内存通常在栈中分配，引用类型内存通常在堆中分配。



## 6. go 调度时机

在四种情形下，goroutine 可能会发生调度，但也并不一定会发生，只是说 Go scheduler 有机会进行调度。

| 情形            | 说明                                                         |
| :-------------- | :----------------------------------------------------------- |
| 使用关键字 `go` | go 创建一个新的 goroutine，Go scheduler 会考虑调度           |
| GC              | 由于进行 GC 的 goroutine 也需要在 M 上运行，因此肯定会发生调度。当然，Go scheduler 还会做很多其他的调度，例如调度不涉及堆访问的 goroutine 来运行。GC 不管栈上的内存，只会回收堆上的内存 |
| 系统调用        | 当 goroutine 进行系统调用时，会阻塞 M，所以它会被调度走，同时一个新的 goroutine 会被调度上来 |
| 内存同步访问    | atomic，mutex，channel 操作等会使 goroutine 阻塞，因此会被调度走。等条件满足后（例如其他 goroutine 解锁了）还会被调度上来继续运行 |



## 7 Go 中哪些动作会触发 runtime 调度？

**第一种：系统调用 SysCall**

**当你在 goroutine 进行一些 sleep 休眠、读取磁盘或者发送网络请求时，其实都会发生系统调用，进入操作系统内核。**

而一旦发生系统调用，就会直接触发 runtime 的调度，当前的 P 就会去找其他的 M 进行绑定，并取出 G 开始运行。

**第二种：等待锁、通道 （阻塞）**

此外，在你的代码中，**若因为锁或者通道导致代码阻塞了，也会触发调度**。

**第三种：人工触发**

在代码中直接调用 **runtime.Gosched** 方法，也可以手动触发。

**第四种：队列轮询**

不考虑G进入系统调用或IO操作的情况下，P周期性的将G调度到M中执行，执行一小段时间，将上下文保存下来，然后将G放到队列尾部，然后从队列中重新取出一个G进行调度。





## 8 golang GC 回收介绍 (标记清除, 三色标记法, 混合写屏障)



## 9 什么时候会触发 golang GC 呢



## 10 golang 如何做超时控制 ? (time.After 和 context.WithTimeOut)



## 11 golang 如何 比较两个 map 使用相等



## 12 协程切换的时机？ (网易面试题)

`切换时机`

- 会阻塞的系统调用，比如文件io，网络io；
- time系列定时操作；
- go func的时候, func执行完的时候；
- 管道读写阻塞的情况；
- 垃圾回收之后。
- 主动调用runtime.Gosched()



## 13 channel的底层结构？接收、发送消息的过程？(网易面试题)



## 14 sync. WaitGroup的底层是怎么样实现的 





## 15 golang context 使用场景





## 16 两个结构体可以比较吗
